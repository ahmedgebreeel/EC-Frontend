<main class="main">
  <!-- Page Title -->
  <div class="page-title light-background">
    <div class="container d-lg-flex justify-content-between align-items-center">
      <h1 class="mb-2 mb-lg-0">Products</h1>
      <nav class="breadcrumbs">
        <ol>
          <li><a routerLink="/home">Home</a></li>
          <li class="current">Products</li>
        </ol>
      </nav>
    </div>
  </div>
  <!-- End Page Title -->

  <div class="container">
    <div class="row">
      <div class="col-lg-4 sidebar">
        <div class="widgets-container">
          <!-- Product Categories Widget -->
          <div class="product-categories-widget widget-item">
            <h3 class="widget-title">Categories</h3>
            @if(allCategories().length > 0){

            <ul class="category-tree list-unstyled mb-0">
              @for(category of categoryTree(); track category.id){
              <li class="category-item">
                <div
                  class="d-flex justify-content-between align-items-center category-header"
                  [class.collapsed]="category.children.length > 0"
                  [attr.data-bs-toggle]="category.children.length > 0 ? 'collapse' : null"
                  [attr.data-bs-target]="category.children.length > 0 ? '#category-' + category.id : null"
                  [attr.aria-expanded]="false"
                  [attr.aria-controls]="category.children.length > 0 ? 'category-' + category.id : null"
                >
                  <a (click)="sortByCategory(category)" class="category-link" style="cursor: pointer">{{ category.name }}</a>
                  @if(category.children.length > 0){
                  <span class="category-toggle">
                    <i class="bi bi-chevron-down"></i>
                    <i class="bi bi-chevron-up"></i>
                  </span>
                  }
                </div>
                @if(category.children.length > 0){
                <ul
                  [id]="'category-' + category.id"
                  class="subcategory-list list-unstyled collapse ps-3 mt-2"
                >
                  @for(subCategory of category.children; track subCategory.id){
                  <li class="category-item">
                    <div
                      class="d-flex justify-content-between align-items-center category-header"
                      [class.collapsed]="subCategory.children.length > 0"
                      [attr.data-bs-toggle]="subCategory.children.length > 0 ? 'collapse' : null"
                      [attr.data-bs-target]="subCategory.children.length > 0 ? '#category-' + subCategory.id : null"
                      [attr.aria-expanded]="false"
                      [attr.aria-controls]="subCategory.children.length > 0 ? 'category-' + subCategory.id : null"
                    >
                      <a (click)="sortByCategory(subCategory)" class="subcategory-link" style="cursor: pointer">{{ subCategory.name }}</a>
                      @if(subCategory.children.length > 0){
                      <span class="category-toggle">
                        <i class="bi bi-chevron-down"></i>
                        <i class="bi bi-chevron-up"></i>
                      </span>
                      }
                    </div>
                    @if(subCategory.children.length > 0){
                    <ul
                      [id]="'category-' + subCategory.id"
                      class="subcategory-list list-unstyled collapse ps-3 mt-2"
                    >
                      @for(thirdLevel of subCategory.children; track thirdLevel.id){
                      <li>
                        <a (click)="sortByCategory(thirdLevel)" class="subcategory-link" style="cursor: pointer">{{ thirdLevel.name }}</a>
                      </li>
                      }
                    </ul>
                    }
                  </li>
                  }
                </ul>
                }
              </li>
              }
            </ul>
            }
          </div>
          <!--/Product Categories Widget -->

          <!-- Pricing Range Widget -->
          <div class="pricing-range-widget widget-item">
            <h3 class="widget-title">Price Range</h3>

            <div class="price-range-container">
              <div class="current-range mb-3">
                <span class="min-price">${{ minValue }}</span>
                <span class="max-price float-end">${{ maxValue }}</span>
              </div>

              <div class="range-slider">
                <div class="slider-track"></div>
                <div
                  class="slider-progress"
                  [style.left.%]="minPercent"
                  [style.width.%]="maxPercent - minPercent"
                ></div>
                <input
                  type="range"
                  class="min-range"
                  min="0"
                  max="1000"
                  value="0"
                  step="10"
                  [(ngModel)]="minValue"
                  (input)="updateSlider()"
                />
                <input
                  type="range"
                  class="max-range"
                  min="0"
                  max="1000"
                  value="500"
                  step="10"
                  [(ngModel)]="maxValue"
                  (input)="updateSlider()"
                />
              </div>

              <div class="price-inputs mt-3">
                <div class="row g-2">
                  <div class="col-6">
                    <div class="input-group input-group-sm">
                      <span class="input-group-text">$</span>
                      <input
                        type="number"
                        class="form-control min-price-input"
                        placeholder="Min"
                        min="0"
                        max="1000"
                        value="{{ minValue }}"
                        step="10"
                      />
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="input-group input-group-sm">
                      <span class="input-group-text">$</span>
                      <input
                        type="number"
                        class="form-control max-price-input"
                        placeholder="Max"
                        min="0"
                        max="1000"
                        value="{{ maxValue }}"
                        step="10"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <div class="filter-actions mt-3">
                <button type="button" (click)="priceFilter()" class="btn btn-sm btn-primary w-100">
                  Apply Filter
                </button>
              </div>
            </div>
          </div>
          <!--/Pricing Range Widget -->

          <!-- Brand Filter Widget -->
          <div class="brand-filter-widget widget-item">
            <h3 class="widget-title">Filter by Brand</h3>

            <div class="brand-filter-content">
              <div class="brand-search">
                <input type="text" class="form-control" placeholder="Search brands..." />
                <i class="bi bi-search"></i>
              </div>

              <div class="brand-list">
                <div class="brand-item">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="brand1" />
                    <label class="form-check-label" for="brand1">
                      Nike
                      <span class="brand-count">(24)</span>
                    </label>
                  </div>
                </div>

                <div class="brand-item">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="brand2" />
                    <label class="form-check-label" for="brand2">
                      Adidas
                      <span class="brand-count">(18)</span>
                    </label>
                  </div>
                </div>

                <div class="brand-item">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="brand3" />
                    <label class="form-check-label" for="brand3">
                      Puma
                      <span class="brand-count">(12)</span>
                    </label>
                  </div>
                </div>

                <div class="brand-item">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="brand4" />
                    <label class="form-check-label" for="brand4">
                      Reebok
                      <span class="brand-count">(9)</span>
                    </label>
                  </div>
                </div>

                <div class="brand-item">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="brand5" />
                    <label class="form-check-label" for="brand5">
                      Under Armour
                      <span class="brand-count">(7)</span>
                    </label>
                  </div>
                </div>

                <div class="brand-item">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="brand6" />
                    <label class="form-check-label" for="brand6">
                      New Balance
                      <span class="brand-count">(6)</span>
                    </label>
                  </div>
                </div>

                <div class="brand-item">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="brand7" />
                    <label class="form-check-label" for="brand7">
                      Converse
                      <span class="brand-count">(5)</span>
                    </label>
                  </div>
                </div>

                <div class="brand-item">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="brand8" />
                    <label class="form-check-label" for="brand8">
                      Vans
                      <span class="brand-count">(4)</span>
                    </label>
                  </div>
                </div>
              </div>

              <div class="brand-actions">
                <button class="btn btn-sm btn-outline-primary">Apply Filter</button>
                <button class="btn btn-sm btn-link">Clear All</button>
              </div>
            </div>
          </div>
          <!--/Brand Filter Widget -->
        </div>
      </div>

      <div class="col-lg-8">
        <!-- Category Header Section -->
        <section id="category-header" class="category-header section">
          <div class="container" data-aos="fade-up">
            <!-- Filter and Sort Options -->
            <div class="filter-container mb-4" data-aos="fade-up" data-aos-delay="100">
              <div class="row g-3">
                <div class="col-12 col-md-6 col-lg-4">
                  <div class="filter-item search-form">
                    <label for="productSearch" class="form-label">Search Products</label>
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control"
                        id="productSearch"
                        placeholder="Search for products..."
                        aria-label="Search for products"
                        (input)="search.set($event.target.value)"
                      />
                      <button class="btn search-btn" type="button">
                        <i class="bi bi-search"></i>
                      </button>
                    </div>
                  </div>
                </div>

                <div class="col-12 col-md-6 col-lg-2">
                  <div class="filter-item">
                    <label for="priceRange" class="form-label">Price Range</label>
                    <select
                      class="form-select"
                      id="priceRange"
                      (change)="filterProductsPrice($event)"
                    >
                      <option value="default" selected="">All Prices</option>
                      <option value="Under $25">Under $25</option>
                      <option value="$25 to $50">$25 to $50</option>
                      <option value="$50 to $100">$50 to $100</option>
                      <option value="$100 to $200">$100 to $200</option>
                      <option value="$200">$200 &amp; Above</option>
                    </select>
                  </div>
                </div>

                <div class="col-12 col-md-6 col-lg-2">
                  <div class="filter-item">
                    <label for="sortBy" class="form-label">Sort By</label>
                    <select class="form-select" (change)="sortProducts($event)" id="sortBy">
                      <option value="default" selected="">Featured</option>
                      <option value="asc">Price: Low to High</option>
                      <option value="dsc">Price: High to Low</option>
                      <option value="new">Customer Rating</option>
                      <option value="pop">Newest Arrivals</option>
                    </select>
                  </div>
                </div>

                <div class="col-12 col-md-6 col-lg-4">
                  <div class="filter-item">
                    <label class="form-label">View</label>
                    <div class="d-flex align-items-center">
                      <div class="view-options me-3">
                        <button
                          type="button"
                          class="btn view-btn active"
                          data-view="grid"
                          aria-label="Grid view"
                          (click)="setView('grid')"
                          [class.active]="viewType() === 'grid'"
                        >
                          <i class="bi bi-grid-3x3-gap-fill"></i>
                        </button>
                        <button
                          type="button"
                          class="btn view-btn"
                          data-view="list"
                          aria-label="List view"
                          (click)="setView('list')"
                          [class.active]="viewType() === 'list'"
                        >
                          <i class="bi bi-list-ul"></i>
                        </button>
                      </div>
                      <!-- <div class="items-per-page">
                        <select class="form-select" id="itemsPerPage" aria-label="Items per page">
                          <option value="12">12 per page</option>
                          <option value="24">24 per page</option>
                          <option value="48">48 per page</option>
                          <option value="96">96 per page</option>
                        </select>
                      </div> -->
                    </div>
                  </div>
                </div>
              </div>
              @if(activeFilters().length > 0){

              <div class="row mt-3">
                <div class="col-12" data-aos="fade-up" data-aos-delay="200">
                  <div class="active-filters">
                    <span class="active-filter-label">Active Filters:</span>
                    <div class="filter-tags">
                      @for(filter of activeFilters();track $index){

                      <span class="filter-tag">
                        {{ filter }} <button class="filter-remove"><i class="bi bi-x"></i></button>
                      </span>
                      }

                      <!-- <span class="filter-tag">
                        Electronics <button class="filter-remove"><i class="bi bi-x"></i></button>
                      </span> -->

                      <button class="clear-all-btn" (click)="clearAllFilters()">Clear All</button>
                    </div>
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
        </section>
        <!-- /Category Header Section -->

        <!-- Category Product List Section -->
        <section
          [ngClass]="viewType()"
          id="category-product-list"
          class="category-product-list section"
        >
          <div class="container" data-aos="fade-up" data-aos-delay="100">
            <div class="row g-4">
              @if(allProducts()){ 
                @for(product of allProducts() | paginate : { itemsPerPage:
              pageSize, currentPage: pageIndex(), totalItems: totalPages()}; track $index) {

              <div [ngClass]="viewType() === 'grid' ? 'col-6 col-xl-4' : 'col-12'">
                <app-product-card
                  [viewType]="viewType()"
                  [productData]="product"
                ></app-product-card>
              </div>

              }}
            </div>
          </div>
        </section>
        <!-- /Category Product List Section -->

        <!-- Category Pagination Section -->
        <div class="pagination-wrapper">
          <div class="pagination">
            <pagination-controls  (pageChange)="pageIndex.set($event); loadProducts()"></pagination-controls>
          </div>
        </div>

        <!-- /Category Pagination Section -->
      </div>
    </div>
  </div>
</main>